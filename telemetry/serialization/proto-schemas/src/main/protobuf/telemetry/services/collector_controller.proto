syntax = "proto3";

package telemetry.service.collector;

import "google/protobuf/timestamp.proto";

option java_multiple_files = true;
option java_package = "ru.yandex.practicum.grpc.telemetry.collector";

/* ----- типы для сценариев ----- */
enum ConditionTypeProto {
  MOTION = 0; LUMINOSITY = 1; SWITCH = 2; TEMPERATURE = 3; CO2LEVEL = 4; HUMIDITY = 5;
}
enum ConditionOperationProto {EQUALS = 0; GREATER_THAN = 1; LESS_THAN = 2;}
message ScenarioConditionProto {
  string sensor_id = 1;
  ConditionTypeProto type = 2;
  ConditionOperationProto operation = 3;
  oneof value {bool bool_value = 4; int32 int_value = 5;}
}
enum ActionTypeProto {ACTIVATE = 0; DEACTIVATE = 1; INVERSE = 2; SET_VALUE = 3;}
message DeviceActionProto {
  string sensor_id = 1;
  ActionTypeProto type = 2;
  optional int32 value = 3;
}

message ScenarioAddedEventProto {
  string name = 1;                                   // ← getName()
  repeated ScenarioConditionProto conditions = 2;     // ← getConditionsList()
  repeated DeviceActionProto actions = 3;             // ← getActionsList()
}
message ScenarioRemovedEventProto {
  string name = 1;                                    // ← getName()
}

/* ----- события хаба ----- */
enum DeviceTypeProto {MOTION_SENSOR = 0; TEMPERATURE_SENSOR = 1; LIGHT_SENSOR = 2; CLIMATE_SENSOR = 3; SWITCH_SENSOR = 4;}
message DeviceAddedEventProto  {string id = 1; DeviceTypeProto type = 2;}
message DeviceRemovedEventProto{string id = 1;}

message HubEventProto {
  string hub_id = 1;
  google.protobuf.Timestamp timestamp = 2;
  oneof payload {
    DeviceAddedEventProto    device_added = 3;
    DeviceRemovedEventProto  device_removed = 4;
    ScenarioAddedEventProto  scenario_added = 5;
    ScenarioRemovedEventProto scenario_removed = 6;
  }
}

/* ----- события сенсоров ----- */
message SensorEventProto {
  string id = 1;
  google.protobuf.Timestamp timestamp = 2;
  string hub_id = 3;        // важно: hub_id (а не hubId) — так ожидает тестовый hub-router
  oneof payload {
    MotionSensorProto       motion_sensor_event = 4;
    TemperatureSensorProto  temperature_sensor_event = 5;
    LightSensorProto        light_sensor_event = 6;
    ClimateSensorProto      climate_sensor_event = 7;
    SwitchSensorProto       switch_sensor_event = 8;
  }
}
message MotionSensorProto      {uint32 link_quality = 1; bool motion = 2; uint32 voltage = 3;}
message TemperatureSensorProto {int32  temperature_c = 1; int32 temperature_f = 2;}
message LightSensorProto       {uint32 link_quality = 1; uint32 luminosity = 2;}
message ClimateSensorProto     {int32  temperature_c = 1; uint32 humidity = 2; uint32 co2_level = 3;}
message SwitchSensorProto      {bool state = 1;}

/* ----- gRPC сервис ----- */
message CollectorResponse {
  enum Status {OK = 0; ERROR = 1; PARTIAL = 2;}
  Status status = 1;
  string message = 2;
  google.protobuf.Timestamp processed_at = 3;
}
service CollectorController {
  rpc CollectSensorEvent (SensorEventProto) returns (CollectorResponse);
  rpc CollectHubEvent    (HubEventProto)    returns (CollectorResponse);
}